# Домашнее задание


- Запуск:
  -  make run-kafka
     - подключиться к zookeeper, создать топик order_status:
  -  make run-all


## Logs

`make logs`

Graylog: http://127.0.0.1:7555/ (admin/admin)

System->Inputs, добавляем инпут типа GELF tcp, все значения по-умолчанию

## Metrics

Prometheus: http://127.0.0.1:9090/

Grafana: http://127.0.0.1:3000/ (admin/admin)

При первом логине в Графану она попросит установить новый пароль, ставим.

Заходим в шестеренку слева, выбираем Data sources, добавляем Prometheus, адрес `http://prometheus:9090`

Нагрузку можно дать по примеру через hey: `hey -c 5 -z 10m "http://127.0.0.1:8080/product_list?skus=201057139+201058638+562553736"`

## Tracing

Jaeger: http://127.0.0.1:16686/


## TODO

1. Перевести логи всех сервисов на структурные. Советую zap, но можете использовать любой другой удобный пакет. Должна быть поддержка уровней логирования.
2. Покрыть все операции трейсами, настроить сбор трейсов в Jaeger, который должен подниматься в композе вместе со всеми сервисами. Должен быть доступ к веб-интерфейсу Jaeger-а.
3. Настроить отдачу сервисами метрик и их сбор Прометеем, запущенным в отдельном контейнере. Обязательно иметь счетчик запросов с детализацией по хендлерам и гистограмму времени обработки запросов с детализацией по кодам ответа и хендлерам для серверов, для клиентов только гистограмму. Сделать это лучше всего через интерсепторы. Плюсом можно добавить еще метрик от себя по вкусу, например для баз данных и запросам в апи продакт-сервиса.
4. Добавить в композ контейнер алерт-менеджера и настроить себе в телеграм алерты на падение сервисов и на высокое количество ошибок от запросов в сервисы.
5. Сделать универсальную платформенную библиотеку, через которую удобно было бы создавать grpc-клиенты, уже обернутые метриками и базовыми трейсами, плюс удобно было бы оборачивать метриками и трейсами grpc-сервер.
6. Сделать универсальную платформенную библиотеку, которой удобно было бы создават клиента к базе данных, уже обернутого метриками и трейсами. Трейс должен быть правильно наполнен данными о запросе автоматически. Метрики должны давать детализацию по разным запросам автоматически.
7. Развернуть GreyLog
